<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Rifa JQ Motors</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{
  font-family:Arial, sans-serif;
  background:
    linear-gradient(rgba(0,0,0,.7),rgba(0,0,0,.7)),
    url("images/fondo.jpg");
  background-size:cover;
  background-position:center;
  background-attachment:fixed;
  margin:0;
  padding:15px;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.card{
  background:rgba(25,25,25,.95);
  width:100%;
  max-width:420px;
  padding:22px;
  border-radius:16px;
  box-shadow:0 15px 35px rgba(0,0,0,.8);
}
h1{text-align:center;margin:0}
.premio{
  text-align:center;
  margin:8px 0 12px;
  color:#00e676;
  font-weight:bold;
}
.contador{
  background:#000;
  padding:10px;
  border-radius:10px;
  text-align:center;
  margin-bottom:12px;
}
input,button{
  width:100%;
  padding:14px;
  margin-top:12px;
  border-radius:10px;
  border:none;
  font-size:16px;
}
input{
  background:#2c2c2c;
  color:#fff;
}
button{
  background:#00c853;
  font-weight:bold;
  cursor:pointer;
}
button:hover{background:#00e676}
.admin-btn{
  background:#ff9800;
  margin-top:15px;
}
.panel-admin{
  display:none;
  margin-top:15px;
  padding:15px;
  background:#111;
  border-radius:12px;
  border:1px solid #333;
}
.panel-admin input{margin-top:8px}
.danger{
  background:#e53935;
  color:#fff;
}
.danger:hover{background:#ff5252}
.small{
  text-align:center;
  font-size:12px;
  opacity:.7;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="card">
<h1>Rifa JQ</h1>

<div class="premio" id="premioTexto">
üéÅ Premio: Servicio completo o descuento especial
</div>

<div class="contador" id="countdown"></div>

<form id="registroForm">
  <input type="text" id="nombre" placeholder="Nombre" required>
  <input type="tel" id="telefono" placeholder="Tel√©fono" required>
  <input type="text" id="moto" placeholder="Moto / Modelo (opcional)">
  <button>Participar</button>
</form>

<button class="admin-btn" id="btnAdmin">ADMIN</button>

<div class="panel-admin" id="panelAdmin">
  <strong>Panel Admin</strong>

  <input type="text" id="nuevoPremio" placeholder="Editar premio">
  <button onclick="guardarPremio()">Guardar premio</button>

  <input type="date" id="fechaRifaInput">
  <button onclick="guardarFecha()">Guardar fecha</button>

  <button onclick="elegirGanador()">üéâ Elegir ganador</button>
  <button class="danger" onclick="nuevaRifa()">‚ôª Nueva rifa</button>
</div>

<div class="small">Al registrarte aceptas ser contactado</div>
</div>

<script>
/* =================== CONFIG =================== */
const STORAGE_FECHA="fechaRifaJQ";
const STORAGE_ADMIN="adminActivo";
const STORAGE_PREMIO="premioRifa";
const STORAGE_BLOQUEO="adminBloqueadoHasta";

/* üîê HASH SHA-256 de contrase√±a "JQ2025" */
const ADMIN_HASH="b2b48c6d81c5a7c217e18d96b3b8b5f7f24954915a43a44e3e8a0b93f53f4b9c";

/* =================== UTIL =================== */
async function sha256(text){
  const buf=new TextEncoder().encode(text);
  const hash=await crypto.subtle.digest("SHA-256",buf);
  return [...new Uint8Array(hash)].map(x=>x.toString(16).padStart(2,"0")).join("");
}

/* =================== FECHA =================== */
function obtenerFecha(){
  let f=localStorage.getItem(STORAGE_FECHA);
  if(!f){
    let d=new Date();
    d.setDate(d.getDate()+21);
    localStorage.setItem(STORAGE_FECHA,d.toISOString());
    return d;
  }
  return new Date(f);
}
let fechaRifa=obtenerFecha();

function guardarFecha(){
  const v=document.getElementById("fechaRifaInput").value;
  if(!v) return alert("Selecciona una fecha");
  localStorage.setItem(STORAGE_FECHA,new Date(v).toISOString());
  fechaRifa=new Date(v);
  alert("Fecha guardada");
}

/* =================== COUNTDOWN =================== */
const cd=document.getElementById("countdown");
function tick(){
  const diff=fechaRifa-new Date();
  if(diff<=0){cd.textContent="üéâ ¬°Hoy es la rifa!";return;}
  const d=Math.floor(diff/86400000);
  const h=Math.floor(diff/3600000)%24;
  const m=Math.floor(diff/60000)%60;
  const s=Math.floor(diff/1000)%60;
  cd.textContent=`‚è≥ ${d}d ${h}h ${m}m ${s}s`;
}
setInterval(tick,1000);tick();

/* =================== PREMIO =================== */
const premioEl=document.getElementById("premioTexto");
const premioGuardado=localStorage.getItem(STORAGE_PREMIO);
if(premioGuardado) premioEl.textContent="üéÅ Premio: "+premioGuardado;

function guardarPremio(){
  const p=document.getElementById("nuevoPremio").value.trim();
  if(!p) return;
  localStorage.setItem(STORAGE_PREMIO,p);
  premioEl.textContent="üéÅ Premio: "+p;
  alert("Premio actualizado");
}

/* =================== REGISTRO =================== */
registroForm.onsubmit=e=>{
  e.preventDefault();
  let regs=JSON.parse(localStorage.getItem("registrosJQ"))||[];
  if(regs.some(r=>r.telefono===telefono.value))
    return alert("Tel√©fono ya registrado");
  regs.push({
    nombre:nombre.value,
    telefono:telefono.value,
    moto:moto.value,
    fecha:new Date().toLocaleString()
  });
  localStorage.setItem("registrosJQ",JSON.stringify(regs));
  alert("Registro exitoso");
  registroForm.reset();
};

/* =================== ADMIN SEGURIDAD =================== */
btnAdmin.onclick=async()=>{
  const bloqueo=localStorage.getItem(STORAGE_BLOQUEO);
  if(bloqueo && Date.now()<bloqueo){
    alert("Admin bloqueado temporalmente");
    return;
  }

  const pass=prompt("Contrase√±a admin");
  if(!pass) return;

  if(await sha256(pass)===ADMIN_HASH){
    localStorage.setItem(STORAGE_ADMIN,"1");
    panelAdmin.style.display="block";
  }else{
    localStorage.setItem(STORAGE_BLOQUEO,Date.now()+300000);
    alert("Contrase√±a incorrecta. Bloqueado 5 min");
  }
};

if(localStorage.getItem(STORAGE_ADMIN))
  panelAdmin.style.display="block";

/* =================== ADMIN FUNCIONES =================== */
function elegirGanador(){
  const r=JSON.parse(localStorage.getItem("registrosJQ"))||[];
  if(!r.length) return alert("No hay participantes");
  const g=r[Math.floor(Math.random()*r.length)];
  alert(`üéâ Ganador:\n${g.nombre}\nTel: ${g.telefono}`);
}

function nuevaRifa(){
  if(!confirm("Borrar participantes y crear nueva rifa?"))return;
  localStorage.removeItem("registrosJQ");
  localStorage.removeItem(STORAGE_FECHA);
  localStorage.removeItem(STORAGE_ADMIN);
  location.reload();
}
</script>
</body>
</html>
