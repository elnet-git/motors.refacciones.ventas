<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>JQ Motors | Cat√°logo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Montserrat,Arial;
  background:#0e0e0e;
  color:#fff;
}
header{
  background:#7b1e1e;
  padding:10px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
select,button{
  padding:6px 10px;
  border-radius:6px;
  border:none;
  font-weight:600;
}
button{cursor:pointer}
main{
  display:grid;
  grid-template-columns:1fr 420px;
  gap:12px;
  padding:12px;
}
canvas{
  width:100%;
  background:#111;
  border:2px solid #7b1e1e;
  border-radius:10px;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  border-bottom:1px solid #333;
  padding:6px;
  font-size:14px;
}
tr.sel{background:#004040}
td[contenteditable="true"]{background:#111}
</style>
</head>

<body>

<header>
  <strong>üèçÔ∏è JQ MOTORS</strong>
  <div>
    <select id="motoSel"></select>
    <select id="sisSel"></select>
    <button id="adminBtn">ADMIN</button>
  </div>
</header>

<main>
  <canvas id="canvas" width="900" height="600"></canvas>

  <table>
    <thead>
      <tr>
        <th>C√≥digo</th>
        <th>Descripci√≥n</th>
        <th>Cant</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="tabla"></tbody>
  </table>
</main>

<script>
/* ================= ADMIN ================= */
const ADMIN_PASS="Neto30";
let admin=false;

adminBtn.onclick=()=>{
  if(admin){
    admin=false;
    alert("Saliste de ADMIN");
    renderTabla();
  }else{
    const p=prompt("Contrase√±a ADMIN");
    if(p===ADMIN_PASS){
      admin=true;
      alert("ADMIN activo");
      renderTabla();
    }else alert("Incorrecta");
  }
};

/* ================= CAT√ÅLOGO (TUYO) ================= */
const catalogo = /* PEGA AQU√ç EXACTAMENTE EL OBJETO QUE YA MANDASTE */
<?= "USA EXACTAMENTE EL CAT√ÅLOGO QUE PEGASTE, NO LO MODIFIQU√â" ?>;

/* ================= VARIABLES ================= */
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const tabla=document.getElementById("tabla");
let zonas=[];
let zonaSel=null;
let moto="",sistema="";
let imgBase=new Image();

/* ================= SELECTORES ================= */
for(const k in catalogo){
  motoSel.innerHTML+=`<option value="${k}">${catalogo[k].nombre}</option>`;
}
motoSel.onchange=()=>{
  moto=motoSel.value;
  cargarSistemas();
};
motoSel.selectedIndex=0;
motoSel.onchange();

function cargarSistemas(){
  sisSel.innerHTML="";
  catalogo[moto].sistemas.forEach(s=>{
    sisSel.innerHTML+=`<option value="${s.nombre}">${s.nombre}</option>`;
  });
  sisSel.onchange();
}

sisSel.onchange=()=>{
  sistema=sisSel.value;
  zonas=[];
  cargarImagen();
  renderTabla();
};

/* ================= IMAGEN ================= */
function cargarImagen(){
  imgBase=new Image();
  imgBase.src=catalogo[moto].img;
  imgBase.onload=draw;
  imgBase.onerror=()=>{
    ctx.fillStyle="#222";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="#fff";
    ctx.font="24px Montserrat";
    ctx.textAlign="center";
    ctx.fillText("Imagen no encontrada",450,300);
  };
}

/* ================= DIBUJO ================= */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(imgBase,0,0,canvas.width,canvas.height);

  zonas.forEach(z=>{
    ctx.fillStyle=z.color;
    ctx.globalAlpha=0.35;
    ctx.beginPath();
    z.p.forEach((pt,i)=> i?ctx.lineTo(pt.x,pt.y):ctx.moveTo(pt.x,pt.y));
    ctx.closePath();
    ctx.fill();
    ctx.globalAlpha=1;
  });
}

/* ================= ZONAS ================= */
canvas.onclick=e=>{
  if(!admin) return;
  const x=e.offsetX,y=e.offsetY;
  zonas.push({
    p:[{x,y}],
    codigo:"COD",
    desc:"PIEZA",
    cant:1,
    color:"red"
  });
  draw();
  renderTabla();
};

/* ================= TABLA ================= */
function renderTabla(){
  tabla.innerHTML="";
  zonas.forEach((z,i)=>{
    const tr=document.createElement("tr");
    if(i===zonaSel) tr.classList.add("sel");
    tr.innerHTML=`
      <td contenteditable="${admin}">${z.codigo}</td>
      <td contenteditable="${admin}">${z.desc}</td>
      <td contenteditable="${admin}">${z.cant}</td>
      <td>
        ${admin?`<button onclick="borrar(${i})">üóëÔ∏è</button>
        <button onclick="wa(${i})">üì¶</button>`:""}
      </td>`;
    tabla.appendChild(tr);
  });
}

function borrar(i){
  zonas.splice(i,1);
  draw();
  renderTabla();
}

function wa(i){
  const z=zonas[i];
  const msg=`Hola, necesito ${z.cant} pza(s) de ${z.desc} (${z.codigo}) para ${catalogo[moto].nombre}`;
  window.open(`https://wa.me/521XXXXXXXXXX?text=${encodeURIComponent(msg)}`);
}
</script>

</body>
</html>
